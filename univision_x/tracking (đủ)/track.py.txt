import numpy as np

class Track:
    def __init__(self, mean, cov, track_id, embedding):
        self.mean = mean          # Kalman state
        self.cov = cov
        self.id = track_id
        self.embedding = embedding

        self.age = 1
        self.hits = 1
        self.time_since_update = 0
        self.is_confirmed = False

    def predict(self, kf):
        self.mean, self.cov = kf.predict(self.mean, self.cov)
        self.age += 1
        self.time_since_update += 1

    def update(self, kf, measurement, embedding):
        self.mean, self.cov = kf.update(self.mean, self.cov, measurement)
        self.embedding = embedding
        self.hits += 1
        self.time_since_update = 0
        if self.hits >= 3:
            self.is_confirmed = True

    def to_bbox(self):
        # xywh
        return self.mean[:4].copy()
